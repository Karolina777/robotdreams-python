SELECT users.id, users.first_name, users.last_name, total_purchases
FROM users JOIN (
                 SELECT purchase.user_id, SUM(books.price) as total_purchases from purchase
                 join books on purchase.book_id = books.id
                 GROUP BY  purchase.user_id
                 )
GROUP BY users.id